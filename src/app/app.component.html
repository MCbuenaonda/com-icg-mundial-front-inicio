<!-- Dashboard Top -->
<div class="row g-4 mb-4">
	<div class="col-12 col-md-5">
		<div class="card h-100">
			<div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
				<span>Intensidad del Partido</span>
				<span class="intensity-badge">{{ getIntensidadActual() }}</span>
			</div>
			<div class="card-body p-3">
				<div class="mb-3">
					<strong class="text-light">Fase Actual:</strong> <span class="text-warning">{{ currentPhase }}</span>
				</div>
				
				<!-- Timeline de momentos clave -->
				<div class="timeline-container" *ngIf="liveMatch && detalle_en_curso">
					<div class="timeline-header mb-2">
						<span class="text-light fw-bold">Momentos Clave</span>
						<span class="text-warning small">{{ getMomentosClaveCount() }} eventos</span>
					</div>
					
					<!-- LÃ­nea de tiempo visual -->
					<div class="timeline-bar">
						<div class="timeline-track">
							<div class="timeline-progress" [style.width.%]="getProgressPercentage()"></div>
							
							<!-- Marcadores de eventos -->
							<div 
								*ngFor="let evento of getMomentosClaveTimeline()" 
								class="timeline-marker animate__animated animate__zoomIn"
								[style.left.%]="evento.posicion"
								[style.top]="evento.offsetY"
								[ngClass]="'marker-' + evento.tipo"
								[title]="evento.minuto + '\' - ' + evento.descripcion">
								<span class="marker-icon">{{ evento.icono }}</span>
								<span class="marker-minute">{{ evento.minuto }}'</span>
							</div>
						</div>
					</div>
					
					<!-- Mapa de calor por perÃ­odos -->
					<div class="heatmap-container mt-3">
						<div class="heatmap-label text-light small mb-1">Intensidad del Partido (90 min)</div>
						
						<!-- Primer Tiempo -->
						<div class="half-section mb-2">
							<div class="half-label text-warning small mb-1">1er Tiempo</div>
						<div class="heatmap-bars">
							<div 
								*ngFor="let periodo of getHeatmapData().slice(0, 9); let i = index" 
								class="heatmap-bar"
								[style.height.%]="periodo.intensidad"
								[ngClass]="'intensity-' + periodo.nivel"
								[title]="'Min ' + (i*5) + '-' + ((i+1)*5) + ': ' + periodo.acciones + ' acciones (Peso: ' + periodo.peso.toFixed(1) + ')' + (periodo.equipoDestacado ? ' - Destacado: ' + periodo.equipoDestacado : '')">
								<img 
									*ngIf="periodo.equipoDestacado" 
									[src]="getIconoUrl(periodo.equipoDestacado)" 
									[alt]="periodo.equipoDestacado"
									class="heatmap-icon">
							</div>
						</div>
							<div class="heatmap-labels">
								<span class="small text-muted">0'</span>
								<span class="small text-muted">20'</span>
								<span class="small text-muted">45'</span>
							</div>
						</div>
						
						<!-- Segundo Tiempo -->
						<div class="half-section">
							<div class="half-label text-warning small mb-1">2do Tiempo</div>
						<div class="heatmap-bars">
							<div 
								*ngFor="let periodo of getHeatmapData().slice(9, 18); let i = index" 
								class="heatmap-bar"
								[style.height.%]="periodo.intensidad"
								[ngClass]="'intensity-' + periodo.nivel"
								[title]="'Min ' + ((i+9)*5) + '-' + ((i+10)*5) + ': ' + periodo.acciones + ' acciones (Peso: ' + periodo.peso.toFixed(1) + ')' + (periodo.equipoDestacado ? ' - Destacado: ' + periodo.equipoDestacado : '')">
								<img 
									*ngIf="periodo.equipoDestacado" 
									[src]="getIconoUrl(periodo.equipoDestacado)" 
									[alt]="periodo.equipoDestacado"
									class="heatmap-icon">
							</div>
						</div>
							<div class="heatmap-labels">
								<span class="small text-muted">45'</span>
								<span class="small text-muted">67'</span>
								<span class="small text-muted">90'</span>
							</div>
						</div>
					</div>
				</div>
				
				<!-- Mensaje cuando no hay partido en vivo -->
				<div *ngIf="!liveMatch" class="text-center text-muted py-3">
					<div class="mb-2">ðŸ“Š</div>
					<small>No hay partido en curso</small>
				</div>
			</div>
		</div>
	</div>
	<div class="col-12 col-md-7" *ngIf="liveMatch">
		<div class="card h-100 border-live">
			<div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
				<span>Partido en Curso</span>
				<span class="live-badge">ðŸ”´ LIVE</span>
			</div>
			<div class="card-body live-card-body">
        <!-- AnimaciÃ³n de GOL -->
        <div *ngIf="mostrarAnimacionGol" class="gol-celebration">
          <div class="gol-explosion">
            <div class="gol-text">âš½ Â¡GOOOOOL! âš½</div>
            <div class="gol-equipo">{{ equipoQueAnoto }}</div>
            <div class="gol-jugador">{{ jugadorQueAnoto }}</div>
            <div class="confetti">
              <div class="confetti-piece" *ngFor="let i of [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]"></div>
            </div>
          </div>
        </div>

        <!-- AnimaciÃ³n de Tarjeta Amarilla -->
        <div *ngIf="mostrarAnimacionTarjetaAmarilla" class="tarjeta-amarilla-celebration">
          <div class="tarjeta-explosion">
            <div class="tarjeta-icono">ðŸŸ¨</div>
            <div class="tarjeta-text">Â¡TARJETA AMARILLA!</div>
            <div class="tarjeta-equipo">{{ equipoAccion }}</div>
            <div class="tarjeta-jugador">{{ jugadorAccion }}</div>
          </div>
        </div>

        <!-- AnimaciÃ³n de Tarjeta Roja -->
          <div *ngIf="mostrarAnimacionTarjetaRoja" class="tarjeta-roja-celebration">
            <div class="tarjeta-explosion">
              <div class="tarjeta-icono">ðŸŸ¥</div>
              <div class="tarjeta-text">Â¡TARJETA ROJA!</div>
              <div class="tarjeta-equipo">{{ equipoAccion }}</div>
              <div class="tarjeta-jugador">{{ jugadorAccion }}</div>
              <div class="expulsion-text">EXPULSIÃ“N</div>
            </div>
          </div>

          <!-- AnimaciÃ³n de RevisiÃ³n VAR -->
          <div *ngIf="mostrarAnimacionVAR" class="var-celebration">
            <div class="var-explosion">
              <div class="var-icono">ðŸ“º</div>
              <div class="var-text">REVISIÃ“N VAR</div>
              <div class="var-mensaje">El Ã¡rbitro revisa la jugada...</div>
              <div class="var-loader">
                <div class="var-dot"></div>
                <div class="var-dot"></div>
                <div class="var-dot"></div>
              </div>
            </div>
          </div>

          <!-- AnimaciÃ³n de Cambio -->
          <div *ngIf="mostrarAnimacionCambio" class="cambio-celebration">
            <div class="cambio-explosion">
              <div class="cambio-icono">ðŸ”„</div>
              <div class="cambio-text">CAMBIO</div>
              <div class="cambio-equipo">{{ equipoAccion }}</div>
              <div class="cambio-jugadores">
                <div class="jugador-sale">
                  <span class="sale-icono">ðŸ”»</span>
                  <span>{{ jugadorSale }}</span>
                </div>
                <div class="jugador-entra">
                  <span class="entra-icono">ðŸ”º</span>
                  <span>{{ jugadorEntra }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- AnimaciÃ³n de LesiÃ³n -->
          <div *ngIf="mostrarAnimacionLesion" class="lesion-celebration">
            <div class="lesion-explosion">
              <div class="lesion-icono">ðŸš‘</div>
              <div class="lesion-text">Â¡LESIÃ“N!</div>
              <div class="lesion-equipo">{{ equipoAccion }}</div>
              <div class="lesion-jugador">{{ jugadorAccion }}</div>
              <div class="lesion-mensaje">AtenciÃ³n mÃ©dica requerida</div>
            </div>
          </div>


        <div class="text-center mb-3">
          <div class="minuto-live animate__animated animate__pulse animate__infinite">{{ minuto_en_vivo || 'En vivo' }}'</div>
        </div>
				<div class="d-flex justify-content-between align-items-center">
					<div class="d-flex align-items-center">
						<img [src]="getEscudoUrl(liveMatch.equipo_local.nombre)" alt="{{ liveMatch.equipo_local.nombre }}" height="50" class="escudo-img">
						<span class="mx-2 fw-bold">{{ liveMatch.equipo_local.nombre }}</span>
					</div>
            <div class="fs-4 fw-bold">{{ detalle_en_curso.goles_local }} - {{ detalle_en_curso.goles_visitante }}</div>
            <div class="d-flex align-items-center">
              <span class="mx-2 fw-bold">{{ liveMatch.equipo_visitante.nombre }}</span>
              <img [src]="getEscudoUrl(liveMatch.equipo_visitante.nombre)" alt="{{ liveMatch.equipo_visitante.nombre }}" height="50" class="escudo-img">
            </div>
				</div>

				<div *ngIf="detalle_en_curso.acciones && detalle_en_curso.acciones.length > 0" class="timeline-acciones">
            <!-- <h4 class="timeline-title text-light">ðŸ“‹ Ãšltima AcciÃ³n</h4> -->
            
            <div class="acciones-container animate__animated animate__fadeInUp">
              <div 
                *ngFor="let accion of getUltimasAcciones(1); let i = index" 
                class="accion-item animate__animated animate__slideInLeft"
                [ngClass]="'importancia-' + accion.importancia"
                [class.accion-nueva]="i === 0">
                
                <div class="accion-contenido">
                  <div class="accion-header">
                    <img [src]="getJerseyUrl(accion.equipo)" alt="{{ accion.equipo }}" class="jersey-img" onerror="this.style.display='none'">
                    <span class="accion-tipo" [ngClass]="'tipo-' + getTipoClass(accion.tipo)">
                      {{ getTipoIcon(accion.tipo) }} {{ accion.tipo }}
                    </span>
                    <span class="accion-equipo">{{ accion.equipo }}</span>
                  </div>                  
                  <div class="accion-descripcion">{{ accion.descripcion }}</div>
                </div>
              </div>
            </div>
          </div>
				<div class="d-flex gap-2 mt-2">
					<a class="btn btn-outline-success flex-fill text-light" [routerLink]="['/mf-get-juego', liveMatch._id]">Ver Detalle del Partido</a>
					<button class="btn btn-outline-warning flex-fill" (click)="scrollToGroups(liveMatch.confederacion_id, liveMatch.grupo)">ðŸ“Š Ver Grupos</button>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Resultados y PrÃ³ximos Partidos -->
<div class="row g-4 mb-4">
	   <div class="col-12 col-md-6">
		   <div class="card h-100 shadow-sm">
			   <div class="card-header bg-secondary text-white">Resultados Recientes</div>
			   <ul class="list-group list-group-flush resultados-list">
				   <li class="list-group-item py-3 px-2 d-flex align-items-center justify-content-between" *ngFor="let match of recentResults">
					   <div class="d-flex align-items-center gap-2">
						   <span class="fecha-badge me-2">{{ match.fecha | fechaEs }}</span>
						   <img [src]="getBanderaUrl(match.equipo_local.iso)" [alt]="match.equipo_local.nombre" height="24" class="flag-img">
						   <span class="fw-bold text-light">{{ match.equipo_local.nombre }}</span>
					   </div>
					   <div class="score-box mx-2 px-2 py-1 rounded bg-dark text-warning fw-bold fs-5">{{ match.resultado.goles_local }} - {{ match.resultado.goles_visitante }}</div>
					   <div class="d-flex align-items-center gap-2">
						   <span class="fw-bold text-light">{{ match.equipo_visitante.nombre }}</span>
						   <img [src]="getBanderaUrl(match.equipo_visitante.iso)" [alt]="match.equipo_visitante.nombre" height="24" class="flag-img">
					   </div>
				   </li>
			   </ul>
		   </div>
	   </div>
	   <div class="col-12 col-md-6">
		   <div class="card h-100 shadow-sm">
			   <div class="card-header bg-warning">PrÃ³ximos Partidos</div>
			   <ul class="list-group list-group-flush resultados-list">
				   <li class="list-group-item py-3 px-2 d-flex align-items-center justify-content-between" *ngFor="let match of upcomingMatches">
					   <div class="d-flex align-items-center gap-2">
						   <span class="fecha-badge me-2">{{ match.fecha | fechaEs }} {{ match.hora }}</span>
						   <img [src]="getBanderaUrl(match.equipo_local.iso)" [alt]="match.equipo_local.nombre" height="24" class="flag-img">
						   <span class="fw-bold text-light">{{ match.equipo_local.nombre }}</span>
					   </div>
					   <div class="score-box mx-2 px-2 py-1 rounded bg-warning text-dark fw-bold fs-6">vs</div>
					   <div class="d-flex align-items-center gap-2">
						   <span class="fw-bold text-light">{{ match.equipo_visitante.nombre }}</span>
						   <img [src]="getBanderaUrl(match.equipo_visitante.iso)" [alt]="match.equipo_visitante.nombre" height="24" class="flag-img">
						   <span class="ms-2 text-info fw-semibold"><i class="bi bi-geo-alt-fill"></i> {{ match.ubicacion.estadio }}</span>
					   </div>
				   </li>
			   </ul>
		   </div>
	   </div>
</div>

<!-- Tabs de VisualizaciÃ³n del Torneo -->
<ul class="nav nav-tabs mb-3" id="torneoTabs" role="tablist">
	<li class="nav-item" role="presentation">
		<button class="nav-link active" id="grupos-tab" data-bs-toggle="tab" data-bs-target="#grupos" type="button" role="tab" aria-controls="grupos" aria-selected="true">ClasificaciÃ³n de Grupos</button>
	</li>
	<li class="nav-item" role="presentation">
		<button class="nav-link" id="eliminatorias-tab" data-bs-toggle="tab" data-bs-target="#eliminatorias" type="button" role="tab" aria-controls="eliminatorias" aria-selected="false">Eliminatorias</button>
	</li>
	<li class="nav-item" role="presentation">
		<button class="nav-link" id="jugadores-tab" data-bs-toggle="tab" data-bs-target="#jugadores" type="button" role="tab" aria-controls="jugadores" aria-selected="false">Mejores Jugadores</button>
	</li>
</ul>
<div class="tab-content" id="torneoTabsContent">
	<div class="tab-pane fade show active" id="grupos" role="tabpanel" aria-labelledby="grupos-tab">
		<div *ngIf="groupsInfo.length; else noGroups">
			<div class="row g-3">
				<ng-container *ngFor="let conf of groupsInfo">
					<div class="col-12">
            <hr>
						<h6 class="text-light mb-2">ConfederaciÃ³n: {{ conf.confederacion_id | nombreConfederacion }}</h6>
					</div>
					<ng-container *ngFor="let entry of conf.grupos | keyvalue">
						<div class="col-12 col-md-3" id="confederacion-{{ conf.confederacion_id }}-{{entry.key}}">
							<div class="card h-100">
								<div class="card-header bg-light">{{ entry.key }}</div>
								<div class="card-body p-2">
									<table class="table table-sm mb-0">
										<thead>
											<tr>
												<th>Pos</th>
												<th>PaÃ­s</th>
												<th>PJ</th>
												<th>G</th>
												<th>E</th>
												<th>P</th>
												<th>Pts</th>
												<th>GF-GC</th>
											</tr>
										</thead>
									<tbody>
										<tr *ngFor="let team of getSortedTeams(conf.grupos, entry.key); let i = index" [class.team-playing]="isTeamPlaying(team.nombre)">
											<td>{{ i + 1 }}</td>
											<td class="d-flex align-items-center gap-2">
												<img [src]="getBanderaUrl(team.iso)" height="18" class="flag-img-table"> 
												<span class="fw-bold">{{ team.siglas || team.nombre }}</span>
												<button *ngIf="isTeamPlaying(team.nombre)" class="live-indicator-btn ms-2" (click)="scrollToLive()" title="Ver partido en vivo">
													ðŸ”´ LIVE
												</button>
											</td>
												<td>{{ team.jj || team.juegos || 0 }}</td>
												<td>{{ team.jg || 0 }}</td>
												<td>{{ team.je || 0 }}</td>
												<td>{{ team.jp || 0 }}</td>
												<td>{{ team.puntos || 0 }}</td>
												<td>{{ team.gf || 0 }}-{{ team.gc || 0 }}</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</ng-container>
				</ng-container>
			</div>
		</div>
		<ng-template #noGroups>
			<div class="p-3 text-center text-muted">Cargando grupos...</div>
		</ng-template>
	</div>
	<div class="tab-pane fade" id="eliminatorias" role="tabpanel" aria-labelledby="eliminatorias-tab">
		<div class="accordion" id="confederacionesAccordion">
			<div class="accordion-item" *ngFor="let conf of ['UEFA','CONMEBOL','CONCACAF','CAF','OFC','AFC']; let i = index">
				<h2 class="accordion-header" id="heading{{i}}">
					<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" [attr.data-bs-target]="'#collapse' + i" aria-expanded="false" [attr.aria-controls]="'collapse' + i">
						{{ conf }}
					</button>
				</h2>
				<div id="collapse{{i}}" class="accordion-collapse collapse" [attr.aria-labelledby]="'heading' + i" data-bs-parent="#confederacionesAccordion">
					<div class="accordion-body">
						<table class="table table-sm mb-0">
							<thead>
								<tr>
									<th>Pos</th>
									<th>PaÃ­s</th>
									<th>Pts</th>
								</tr>
							</thead>
							<tbody>
								<tr *ngFor="let pos of [1,2,3,4]">
									<td>{{ pos }}</td>
									<td><img [src]="getBanderaUrl('MX')" height="18">BRA</td>
									<td>9</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="tab-pane fade" id="jugadores" role="tabpanel" aria-labelledby="jugadores-tab">
		<div class="row g-3">
			<div class="col-12 col-md-6">
				<div class="card">
					<div class="card-header bg-light">MÃ¡ximos Goleadores</div>
					<div class="card-body p-2">
						<table class="table table-sm mb-0">
							<thead>
								<tr>
									<th>Jugador</th>
									<th>PaÃ­s</th>
									<th>Goles</th>
								</tr>
							</thead>
							<tbody>
								<tr *ngFor="let player of playerStats | slice:0:10">
									<td>{{ player.player }}</td>
									<td><img [src]="player.country.flagUrl" height="18"> {{ player.country.name }}</td>
									<td>{{ player.goals }}</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="col-12 col-md-6">
				<div class="card">
					<div class="card-header bg-light">MÃ¡ximos Asistidores</div>
					<div class="card-body p-2">
						<table class="table table-sm mb-0">
							<thead>
								<tr>
									<th>Jugador</th>
									<th>PaÃ­s</th>
									<th>Asistencias</th>
								</tr>
							</thead>
							<tbody>
								<tr *ngFor="let player of playerStats | slice:0:10">
									<td>{{ player.player }}</td>
									<td><img [src]="player.country.flagUrl" height="18"> {{ player.country.name }}</td>
									<td>{{ player.assists }}</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Footer -->
<footer class="footer mt-5 py-3 text-center">
	<div>SimulaciÃ³n Copa del Mundo 2026 &copy; 2025 | Desarrollado por MCbuenaonda</div>
</footer>

<!-- BotÃ³n flotante scroll to top -->
<button 
	*ngIf="showScrollButton" 
	class="scroll-to-top-btn animate__animated animate__fadeInUp" 
	(click)="scrollToTop()"
	title="Volver arriba">
	<span class="arrow-up">â¬†</span>
</button>
